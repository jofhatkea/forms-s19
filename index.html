<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <main></main>
    <template>
      <article>
        <h1></h1>
        <h2></h2>
        <button>Delete Me</button>
      </article>
    </template>
    <button>Add album</button>
    <script>
      function post(newAlbum) {
        fetch("https://music-2ccc.restdb.io/rest/albums", {
          method: "post",
          body: JSON.stringify(newAlbum),
          headers: {
            "Content-Type": "application/json; charset=utf-8",
            "x-apikey": "5c7ce841cac6621685acbaa8",
            "cache-control": "no-cache"
          }
        })
          .then(res => res.json())
          .then(data => {
            //console.log(data);
            showAlbum(data);
          });
      }

      function get() {
        fetch("https://music-2ccc.restdb.io/rest/albums", {
          method: "get",
          headers: {
            "Content-Type": "application/json; charset=utf-8",
            "x-apikey": "5c7ce841cac6621685acbaa8",
            "cache-control": "no-cache"
          }
        })
          .then(res => res.json())
          .then(data => {
            console.log(data);

            data.forEach(showAlbum);
          });
      }
      function showAlbum(album) {
        const template = document.querySelector("template").content;
        const clone = template.cloneNode(true);
        clone.querySelector("h1").textContent = album.artist;
        clone.querySelector("h2").textContent = album.album;
        clone.querySelector("article").dataset.id = album._id;
        clone.querySelector("button").addEventListener("click", e => {
          //console.log(e.target);
          e.target.parentElement.remove();
          deleteAlbum(album._id);
        });

        document.querySelector("main").appendChild(clone);
      }

      function deleteAlbum(id) {
        fetch("https://music-2ccc.restdb.io/rest/albums/" + id, {
          method: "delete",
          headers: {
            "Content-Type": "application/json; charset=utf-8",
            "x-apikey": "5c7ce841cac6621685acbaa8",
            "cache-control": "no-cache"
          }
        })
          .then(res => res.json())
          .then(data => {
            console.log(data);
          });
      }

      get();

      document.querySelector("button").addEventListener("click", () => {
        const obj = {
          artist: "Britney",
          title: "Oops"
        };
        post(obj);
      });
    </script>
  </body>
</html>
